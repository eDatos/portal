<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://cocoon.apache.org/schema/configurator http://cocoon.apache.org/schema/configurator/cocoon-configurator-1.1.0.xsd">

    
    <!-- Common configuration -->
    <import resource="classpath:spring/droids/droids-core-context-common.xml" />
    
    
    <!-- ****************************************************************
                    Infrastructure for INE 
         **************************************************************** -->
    
    <!-- Queue -->
    <bean name="ineQueue" class="com.stat4you.crawler.droids.impl.Stat4youSimpleTaskQueueWithHistory"/>

    <!-- Simple Task Master, use MultiThreadedTaskMaster if you desire better performance (Multiple connections to providers) -->
    <bean name="ineTaskMaster" class="org.apache.droids.impl.SequentialTaskMaster">
        <property name="exceptionHandler" ref="taskExceptionHandler" />
        <property name="delayTimer" ref="delayTimer" />
    </bean>
    
    <!-- Parsers: The ParserFactory will lookup a parser by its identifier (content type) and return it. -->
    
    <!--  HTML parser  -->
    <bean id="ineHtmlParser" name="text/html" class="com.stat4you.crawler.droids.parse.html.IneHtmlParser">
        <property name="elements">
            <map>
                <entry key="a" value="href" />
                <entry key="link" value="href" />
                <entry key="img" value="src" />
                <entry key="script" value="src" />
                <entry key="option" value="value" />
            </map>
        </property>
        <property name="crawlerInfo" ref="ineCrawlerInfo" />
        <property name="forceModeFilter" ref="ineForceModeFilter" />
    </bean>

    <!-- Crawler Information -->
    <bean name="ineCrawlerInfo" class="com.stat4you.crawler.util.CrawlerInfo">
        <property name="crawlerName" value="INE" />
        <property name="providerUrl" value="${stat4you.crawler.droids.provider.ine.url}" />        
        <property name="fileRepositoryIndex" ref="ineFileRepositoryIndex" />
    </bean>
    
    <!-- Repository Index -->
    <bean name="ineFileRepositoryIndex" class="com.stat4you.crawler.util.FileRepositoryIndex">
        <property name="crawlerInfo" ref="ineCrawlerInfo" />
    </bean>

    <!-- Filter -->
    <bean name="ineFilter" class="org.apache.droids.net.RegexURLFilter">
        <property name="file" value="classpath:/regex-urlfilter-ine.txt" />
    </bean>
    
    <bean name="ineForceModeFilter" class="org.apache.droids.net.RegexURLFilter">
        <property name="file" value="classpath:/regex-urlfilter-ine-forcemode.txt" />
    </bean>

    <!-- Handler -->
    <bean name="ineSavePxHandler" class="com.stat4you.crawler.droids.handle.SavePxHandler">
        <property name="outputDir" value="${stat4you.crawler.droids.handler.save.dir}" />
        <property name="includeHost" value="true" />
        <property name="crawlerInfo" ref="ineCrawlerInfo" />
    </bean>
        
    <bean name="inePxHandler" class="com.stat4you.crawler.droids.handle.PxHandler">
        <property name="crawlerInfo" ref="ineCrawlerInfo" />
    </bean>

    <!-- Factories  -->

    <!-- Parsers -->
    <bean name="ineParserFactory" class="org.apache.droids.helper.factories.ParserFactory">
        <property name="map">
            <map>
                <entry key="text/html" value-ref="ineHtmlParser"></entry>
                <entry key="text/plain" value-ref="documentParser"></entry>
                <entry key="application/unknow" value-ref="documentParser"></entry>
                <entry key="application/px" value-ref="documentParser"></entry>             
            </map>
        </property>
    </bean>


    <!-- Filters -->
    <bean id="ineFiltersFactory" class="org.apache.droids.helper.factories.URLFiltersFactory">
        <property name="map">
            <map>
                <entry key="org.apache.droids.net.RegexURLFilter" value-ref="ineFilter"></entry>          
            </map>
        </property>
    </bean>
 
    <!-- Handlers -->
    <bean id="ineHandlerFactory" class="com.stat4you.crawler.droids.helper.factories.HandlerFactoryStat4you">
        <property name="map">
            <map>
                <entry key="savePxHandler" value-ref="ineSavePxHandler"></entry>
<!--                 <entry key="pxHandler" value-ref="inePxHandler"></entry> -->
            </map>
        </property>
    </bean>
 
 
    <!-- Droid -->
    <bean name="ineCrawler" class="com.stat4you.crawler.droids.impl.Stat4youPxCrawlingDroid">
        <constructor-arg ref="ineQueue" />
        <constructor-arg ref="ineTaskMaster" />

        <property name="handlerFactory" ref="ineHandlerFactory" />
        <property name="protocolFactory" ref="org.apache.droids.helper.factories.ProtocolFactory" />
        <property name="parserFactory" ref="ineParserFactory" />
        <property name="filtersFactory" ref="ineFiltersFactory" />
        
        <property name="crawlerInfo" ref="ineCrawlerInfo" />
    </bean>


</beans>

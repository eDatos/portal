/*! stat4you-web 2013-07-25 */
(function(){"use strict";STAT4YOU.namespace("STAT4YOU.modules.navbar.NavbarView"),STAT4YOU.modules.navbar.NavbarView=Backbone.View.extend({template:STAT4YOU.templateManager.get("navbar/navbar"),initialize:function(e){this.userModel=e.userModel,this.location=e.location||window.location.pathname},events:{"click .icon-search-min ":"search","click .locale .dropdown-menu a":"changeLocale","click .navbar-signin":"signin"},_toLocaleObj:function(e){return{id:e,label:I18n.t("app.lang.names."+e)}},render:function(){var e={},t=["es","en","eu","ca"];e.locales=_.map(t,this._toLocaleObj),e.currentLocale=this._toLocaleObj(I18n.currentLocale()),this.userModel&&(e.user=this.userModel.toJSON()),this.$el.html(this.template(e)),this.activeMenuByLocation()},search:function(){var e=this.$el.find(".navbar-search");e.submit()},activeMenuByLocation:function(){var e=this;$(".nav.links li",this.$el).each(function(t,n){var r=$(n),i=r.find("a"),a=i.attr("href"),s=RegExp("^"+a+"(/?)[^/]*$","i");s.test(e.location)&&r.addClass("active")})},changeLocale:function(e){var t=$(e.currentTarget).attr("href"),n=window.location.href,r=t+"&target="+n;return window.location=r,!1},signin:function(e){e.preventDefault(),STAT4YOU.getSigninView().show()}})})(),function(){"use strict";STAT4YOU.namespace("STAT4YOU.modules.user.Favourite"),STAT4YOU.modules.user.Favourite=Backbone.Model.extend({idAttribute:"identifier",initialize:function(e,t){t&&(this.user=t.user)},urlRoot:function(){var e=this._getUser();return e?STAT4YOU.context+"/api/v1.0/users/"+e.get("identifier")+"/favourites":void 0},_getUser:function(){return this.user||STAT4YOU.user}})}(),function(){"use strict";STAT4YOU.namespace("STAT4YOU.modules.user.Favourites");var e=STAT4YOU.modules.user.Favourite;STAT4YOU.modules.user.Favourites=Backbone.Collection.extend({model:e,initialize:function(e,t){this.user=t.user},url:function(){return STAT4YOU.context+"/api/v1.0/users/"+this.user.get("identifier")+"/favourites"},parse:function(e){return e.items},findDataset:function(e){return this.findDatasetByUri(e.uri)},findDatasetByUri:function(e){var t=this.find(function(t){return t.get("dataset").uri===e});return t},isFav:function(e){var t=this.findDataset(e);return void 0!==t},toggle:function(t){var n=this.findDatasetByUri(t),r=this;if(n)r.remove(n),n.destroy();else{var i=new e({dataset:{uri:t}});r.add(i),i.save()}}})}(),function(){"use strict";STAT4YOU.namespace("STAT4YOU.modules.user.User");var e=STAT4YOU.modules.user.Favourites;STAT4YOU.modules.user.User=Backbone.Model.extend({urlRoot:STAT4YOU.context+"/api/v1.0/users/",idAttribute:"identifier",initialize:function(){this.favourites=new e([],{user:this})}})}(),STAT4YOU.namespace("STAT4YOU.libs"),STAT4YOU.libs.navigationSearch=function(e){var t=e instanceof $?e:$(e),n=t.find(".icon-search");n.click(function(){t.trigger("submit")})},STAT4YOU.namespace("STAT4YOU.libs"),STAT4YOU.libs.AjaxForm=function(e){var t=e.attr("action"),n=e.serialize();this.url=t+"#!/?"+n},STAT4YOU.libs.AjaxForm.prototype.redirect=function(){window.location=this.url},STAT4YOU.libs.AjaxForm.eventCallback=function(){return new STAT4YOU.libs.AjaxForm($(this)).redirect(),!1},STAT4YOU.libs.AjaxForm.captureAllForms=function(){$(document).on("submit","form.ajax-form",STAT4YOU.libs.AjaxForm.eventCallback)},$(function(){STAT4YOU.libs.AjaxForm.captureAllForms()});
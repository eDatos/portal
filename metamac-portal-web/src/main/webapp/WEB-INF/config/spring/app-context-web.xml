<?xml version="1.0" encoding="UTF-8"?>
<beans  xmlns="http://www.springframework.org/schema/beans"
        xmlns:mvc="http://www.springframework.org/schema/mvc"
        xmlns:context="http://www.springframework.org/schema/context"
        xmlns:p="http://www.springframework.org/schema/p"
        xmlns:beans="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"    
        xsi:schemaLocation="
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd
            http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd">

    <context:property-placeholder />

    <!-- Scans within the base package of the application for @Components to configure as beans -->
    <bean id="messageSource" class="com.stat4you.web.messages.CustomResourceBundleMessageSource">
        <property name="basename"     value="classpath:i18n/messages" />
        <property name="fallbackToSystemLocale" value="false"/>
        <property name="useCodeAsDefaultMessage" value="true" />


        <!-- TODO change in production mode -->
        <property name="cacheSeconds" value="0" />
    </bean>

    <!-- Sets up standard HandlerMapping and HanderAdapter for use with annotations.
         Allows customization of various MVC-related aspects like binding and validation. -->
    <mvc:annotation-driven conversion-service="conversionService" />
    
    <bean id="conversionService" class="org.springframework.context.support.ConversionServiceFactoryBean">
    	<property name="converters">
        	<set>
	            <bean class="com.stat4you.web.converter.InternationalStringConverter"/>
	            <bean class="com.stat4you.web.converter.DatasetStateToStringConverter"/>
	            <bean class="com.stat4you.web.converter.DatasetSourceToStringConverter"/>
	            <bean class="com.stat4you.web.converter.DimensionTypeToStringConverter"/>
	            <bean class="com.stat4you.web.converter.DateTimeConverter"/>
    	    </set>
    	</property>
	</bean>
    
    <!-- Configurer that sets up a shared FreeMarker Configuration for FreeMarker views -->
    <bean id="freemarkerConfigurer"  class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer">
          <property name="defaultEncoding" value="UTF-8" />
          <property name="templateLoaderPath" value="/WEB-INF/views" />         
      </bean>

    <!-- Simple ViewResolver for FreeMarker, appending ".ftl" to logical view names. -->
    <bean id="viewResolver" class="org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver" >
          <property name="cache" value="true" />
          <property name="prefix" value="" />
          <property name="suffix" value=".ftl" />
          <property name="contentType" value="text/html; charset=UTF-8" />
          <property name="viewClass" value="com.stat4you.web.view.FreeMarkerHelperView" />
          <property name="exposeSpringMacroHelpers" value="true" />
          <property name="exposeRequestAttributes" value="true" />
          <property name="exposeSessionAttributes" value="true" />
          <property name="allowSessionOverride" value="true" />
          <property name="allowRequestOverride" value="true" />      
          <property name="requestContextAttribute" value="rc"/>                        
    </bean>

	<!-- Configure the multipart resolver -->
    <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <!-- one of the properties available; the maximum file size in bytes -->
        <property name="maxUploadSize" value="100000"/>
    </bean>

    <!-- Locale resolver -->
    <bean id="localeResolver" class="com.stat4you.web.messages.CookieLocaleResolver">
        <property name="defaultLocale" value="en" />
        <property name="cookieName" value="s4y.locale" />
        <property name="supportedLocales">
            <set>
                <value>es</value>
                <value>en</value>
                <value>ca</value>
                <value>eu</value>
            </set>
        </property>
    </bean>
    
    <!-- Imports user-defined @Controller beans that process client requests -->
    <import resource="app-context-web-controllers.xml" />
    <import resource="app-context-web-resources.xml" />
    <import resource="app-context-web-rest.xml" />
    <import resource="app-context-web-email.xml" />

</beans>